os:
  - Ubuntu
clone_script:
  - cmd: >-
      git clone -q --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
      && cd %APPVEYOR_BUILD_FOLDER%
      && git checkout -qf %APPVEYOR_REPO_COMMIT%
      && git submodule update --init --recursive
install:
  - sudo apt install -y ocl-icd-opencl-dev
platform:
  - x64
configuration:
  - Release
environment:
  matrix:
   - SETARCH: i686
   - SETARCH: x86_64
matrix:
  fast_finish: true     # set this flag to immediately finish build once one of the jobs fails.
  allow_failures:
    - platform: x86
      configuration: Debug
    - platform: x64
      configuration: Release
before_build:
  # Setup environment:
  - cd %APPVEYOR_BUILD_FOLDER%
  - mkdir build
  - cd build
  - cmake --build .
  - echo %TOP%
  - cmake -DOPENCL_LIBRARIES="OpenCL" -H. -DARCH=%SETARCH%
build:
  project: build_win\CLConform.sln
  parallel: true
  verbosity: normal